!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(r){"use strict";function a(t){return"[object Array]"==Object.prototype.toString.call(t)}function c(t){var e=t.doc.modeOption;return"sql"===e&&(e="text/x-sql"),r.resolveMode(e).keywords}function p(t){var e=t.doc.modeOption;return"sql"===e&&(e="text/x-sql"),r.resolveMode(e).identifierQuote||"`"}function i(t){return"string"==typeof t?t:t.text}function s(t,e){return a(e)&&(e={columns:e}),e.text||(e.text=t),e}function d(t){var e={};if(a(t))for(var r=t.length-1;0<=r;r--){var n=t[r];e[i(n).toUpperCase()]=s(i(n),n)}else if(t)for(var o in t)e[o.toUpperCase()]=s(o,t[o]);return e}function g(t){return A[t.toUpperCase()]}function h(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function u(t,e){var r=t.length,n=i(e).substr(0,r);return t.toUpperCase()===n.toUpperCase()}function v(t,e,r,n){if(a(r))for(var o=0;o<r.length;o++)u(e,r[o])&&t.push(n(r[o]));else for(var i in r)if(r.hasOwnProperty(i)){var s=r[i];u(e,s=s&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(n(s))}}function x(t){"."==t.charAt(0)&&(t=t.substr(1));for(var e=t.split(j+j),r=0;r<e.length;r++)e[r]=e[r].replace(new RegExp(j,"g"),"");return e.join(j)}function m(t){for(var e=i(t).split("."),r=0;r<e.length;r++)e[r]=j+e[r].replace(new RegExp(j,"g"),j+j)+j;var n=e.join(".");return"string"==typeof t?n:((t=h(t)).text=n,t)}function b(t,e,r,n){for(var o=!1,i=[],s=e.start,a=!0;a;)a="."==e.string.charAt(0),o=o||e.string.charAt(0)==j,s=e.start,i.unshift(x(e.string)),"."==(e=n.getTokenAt(O(t.line,e.start))).string&&(a=!0,e=n.getTokenAt(O(t.line,e.start)));var u=i.join(".");v(r,u,A,function(t){return o?m(t):t}),v(r,u,q,function(t){return o?m(t):t}),u=i.pop();var l=i.join("."),f=!1,c=l;if(!g(l)){var p=l;(l=C(l,n))!==p&&(f=!0)}var d=g(l);return d&&d.columns&&(d=d.columns),d&&v(r,u,d,function(t){var e=l;return 1==f&&(e=c),"string"==typeof t?t=e+"."+t:(t=h(t)).text=e+"."+t.text,o?m(t):t}),s}function y(t,e){for(var r=t.split(/\s+/),n=0;n<r.length;n++)r[n]&&e(r[n].replace(/[,;]/g,""))}function C(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),i="",s="",a=[],u={start:O(0,0),end:O(e.lastLine(),e.getLineHandle(e.lastLine()).length)},l=n.indexOf(w.QUERY_DIV);-1!=l;)a.push(r.posFromIndex(l)),l=n.indexOf(w.QUERY_DIV,l+1);a.unshift(O(0,0)),a.push(O(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var f=null,c=e.getCursor(),p=0;p<a.length;p++){if((null==f||0<L(c,f))&&L(c,a[p])<=0){u={start:f,end:a[p]};break}f=a[p]}if(u.start){var d=r.getRange(u.start,u.end,!1);for(p=0;p<d.length;p++){if(y(d[p],function(t){var e=t.toUpperCase();e===o&&g(i)&&(s=i),e!==w.ALIAS_KEYWORD&&(i=t)}),s)break}}return s}var A,q,U,j,w={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},O=r.Pos,L=r.cmpPos;r.registerHelper("hint","sql",function(t,e){A=d(e&&e.tables);var r=e&&e.defaultTable,n=e&&e.disableKeywords;q=r&&g(r),U=c(t),j=p(t),r&&!q&&(q=C(r,t)),(q=q||[]).columns&&(q=q.columns);var o,i,s,a=t.getCursor(),u=[],l=t.getTokenAt(a);if(l.end>a.ch&&(l.end=a.ch,l.string=l.string.slice(0,a.ch-l.start)),l.string.match(/^[.`"\w@]\w*$/)?(s=l.string,o=l.start,i=l.end):(o=i=a.ch,s=""),"."==s.charAt(0)||s.charAt(0)==j)o=b(a,l,u,t);else{var f=function(t,e){return"object"==typeof t?t.className=e:t={text:t,className:e},t};v(u,s,q,function(t){return f(t,"CodeMirror-hint-table CodeMirror-hint-default-table")}),v(u,s,A,function(t){return f(t,"CodeMirror-hint-table")}),n||v(u,s,U,function(t){return f(t.toUpperCase(),"CodeMirror-hint-keyword")})}return{list:u,from:O(a.line,o),to:O(a.line,i)}})});