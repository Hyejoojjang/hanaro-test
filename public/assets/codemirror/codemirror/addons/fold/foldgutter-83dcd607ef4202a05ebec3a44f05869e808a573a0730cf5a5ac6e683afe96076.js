!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],t):t(CodeMirror)}(function(r){"use strict";function n(t){this.options=t,this.from=this.to=0}function i(t){return!0===t&&(t={}),null==t.gutter&&(t.gutter="CodeMirror-foldgutter"),null==t.indicatorOpen&&(t.indicatorOpen="CodeMirror-foldgutter-open"),null==t.indicatorFolded&&(t.indicatorFolded="CodeMirror-foldgutter-folded"),t}function s(t,o){for(var e=t.findMarks(m(o,0),m(o+1,0)),r=0;r<e.length;++r)if(e[r].__isFold){var n=e[r].find(-1);if(n&&n.line===o)return e[r]}}function p(t){if("string"!=typeof t)return t.cloneNode(!0);var o=document.createElement("div");return o.className=t+" CodeMirror-guttermarker-subtle",o}function f(i,t,o){var f=i.state.foldGutter.options,a=t-1,d=i.foldOption(f,"minFoldSize"),u=i.foldOption(f,"rangeFinder"),l="string"==typeof f.indicatorFolded&&e(f.indicatorFolded),c="string"==typeof f.indicatorOpen&&e(f.indicatorOpen);i.eachLine(t,o,function(t){++a;var o=null,e=t.gutterMarkers;if(e&&(e=e[f.gutter]),s(i,a)){if(l&&e&&l.test(e.className))return;o=p(f.indicatorFolded)}else{var r=m(a,0),n=u&&u(i,r);if(n&&n.to.line-n.from.line>=d){if(c&&e&&c.test(e.className))return;o=p(f.indicatorOpen)}}(o||e)&&i.setGutterMarker(t,f.gutter,o)})}function e(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}function a(t){var o=t.getViewport(),e=t.state.foldGutter;e&&(t.operation(function(){f(t,o.from,o.to)}),e.from=o.from,e.to=o.to)}function d(t,o,e){var r=t.state.foldGutter;if(r){var n=r.options;if(e==n.gutter){var i=s(t,o);i?i.clear():t.foldCode(m(o,0),n)}}}function u(t){var o=t.state.foldGutter;if(o){var e=o.options;o.from=o.to=0,clearTimeout(o.changeUpdate),o.changeUpdate=setTimeout(function(){a(t)},e.foldOnChangeTimeSpan||600)}}function l(o){var e=o.state.foldGutter;if(e){var t=e.options;clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){var t=o.getViewport();e.from==e.to||20<t.from-e.to||20<e.from-t.to?a(o):o.operation(function(){t.from<e.from&&(f(o,t.from,e.from),e.from=t.from),t.to>e.to&&(f(o,e.to,t.to),e.to=t.to)})},t.updateViewportTimeSpan||400)}}function c(t,o){var e=t.state.foldGutter;if(e){var r=o.line;r>=e.from&&r<e.to&&f(t,r,r+1)}}r.defineOption("foldGutter",!1,function(t,o,e){e&&e!=r.Init&&(t.clearGutter(t.state.foldGutter.options.gutter),t.state.foldGutter=null,t.off("gutterClick",d),t.off("changes",u),t.off("viewportChange",l),t.off("fold",c),t.off("unfold",c),t.off("swapDoc",u)),o&&(t.state.foldGutter=new n(i(o)),a(t),t.on("gutterClick",d),t.on("changes",u),t.on("viewportChange",l),t.on("fold",c),t.on("unfold",c),t.on("swapDoc",u))});var m=r.Pos});