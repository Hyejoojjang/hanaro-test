!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(C){function x(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:a[t]}function r(e){for(var t=0;t<e.length;t++){var n=e.charAt(t),r="'"+n+"'";o[r]||(o[r]=i(n))}}function i(t){return function(e){return n(e,t)}}function P(e){var t=e.state.closeBrackets;return!t||t.override?t:e.getModeAt(e.getCursor()).closeBrackets||t}function e(e){var t=P(e);if(!t||e.getOption("disableInput"))return C.Pass;for(var n=x(t,"pairs"),r=e.listSelections(),i=0;i<r.length;i++){if(!r[i].empty())return C.Pass;var a=s(e,r[i].head);if(!a||n.indexOf(a)%2!=0)return C.Pass}for(i=r.length-1;0<=i;i--){var o=r[i].head;e.replaceRange("",S(o.line,o.ch-1),S(o.line,o.ch+1),"+delete")}}function t(r){var e=P(r),t=e&&x(e,"explode");if(!t||r.getOption("disableInput"))return C.Pass;for(var i=r.listSelections(),n=0;n<i.length;n++){if(!i[n].empty())return C.Pass;var a=s(r,i[n].head);if(!a||t.indexOf(a)%2!=0)return C.Pass}r.operation(function(){var e=r.lineSeparator()||"\n";r.replaceSelection(e+e,null),r.execCommand("goCharLeft"),i=r.listSelections();for(var t=0;t<i.length;t++){var n=i[t].head.line;r.indentLine(n,null,!0),r.indentLine(n+1,null,!0)}})}function k(e){var t=0<C.cmpPos(e.anchor,e.head);return{anchor:new S(e.anchor.line,e.anchor.ch+(t?-1:1)),head:new S(e.head.line,e.head.ch+(t?1:-1))}}function n(n,e){var t=P(n);if(!t||n.getOption("disableInput"))return C.Pass;var r=x(t,"pairs"),i=r.indexOf(e);if(-1==i)return C.Pass;for(var a,o=x(t,"closeBefore"),s=x(t,"triples"),l=r.charAt(i+1)==e,c=n.listSelections(),f=i%2==0,h=0;h<c.length;h++){var u,d=c[h],p=d.head,g=n.getRange(p,S(p.line,p.ch+1));if(f&&!d.empty())u="surround";else if(!l&&f||g!=e)if(l&&1<p.ch&&0<=s.indexOf(e)&&n.getRange(S(p.line,p.ch-2),p)==e+e){if(2<p.ch&&/\bstring/.test(n.getTokenTypeAt(S(p.line,p.ch-2))))return C.Pass;u="addFour"}else if(l){var v=0==p.ch?" ":n.getRange(S(p.line,p.ch-1),p);if(C.isWordChar(g)||v==e||C.isWordChar(v))return C.Pass;u="both"}else{if(!f||!(0===g.length||/\s/.test(g)||-1<o.indexOf(g)))return C.Pass;u="both"}else u=l&&y(n,p)?"both":0<=s.indexOf(e)&&n.getRange(p,S(p.line,p.ch+3))==e+e+e?"skipThree":"skip";if(a){if(a!=u)return C.Pass}else a=u}var m=i%2?r.charAt(i-1):e,b=i%2?e:r.charAt(i+1);n.operation(function(){if("skip"==a)n.execCommand("goCharRight");else if("skipThree"==a)for(var e=0;e<3;e++)n.execCommand("goCharRight");else if("surround"==a){var t=n.getSelections();for(e=0;e<t.length;e++)t[e]=m+t[e]+b;n.replaceSelections(t,"around"),t=n.listSelections().slice();for(e=0;e<t.length;e++)t[e]=k(t[e]);n.setSelections(t)}else"both"==a?(n.replaceSelection(m+b,null),n.triggerElectric(m+b),n.execCommand("goCharLeft")):"addFour"==a&&(n.replaceSelection(m+m+m+m,"before"),n.execCommand("goCharRight"))})}function s(e,t){var n=e.getRange(S(t.line,t.ch-1),S(t.line,t.ch+1));return 2==n.length?n:null}function y(e,t){var n=e.getTokenAt(S(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch&&(0==t.ch||!/\bstring/.test(e.getTokenTypeAt(t)))}var a={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},S=C.Pos;C.defineOption("autoCloseBrackets",!1,function(e,t,n){n&&n!=C.Init&&(e.removeKeyMap(o),e.state.closeBrackets=null),t&&(r(x(t,"pairs")),e.state.closeBrackets=t,e.addKeyMap(o))});var o={Backspace:e,Enter:t};r(a.pairs+"`")});